# ansible-playbook -i ./hosts MYSERVERCENTOS.yml -K


---

  - hosts: localhost
    become: yes
    tasks:

    - name: upgrade all packages
      yum:
        name: '*'
        state: latest

    - name: Install packages
      yum:
        name:
          - dnf-automatic
          - ansible
          - podman
          - podman-docker
          - vim
          - yum-utils
          - python3
          - epel-release
          - setroubleshoot
          - autofs
          - cronie
        state: latest

    - name: Start service dnf-automatic.timer, if not started
      service:
          name: dnf-automatic.timer
          state: started

    - name: Enable service dnf-automatic.timer, and not touch the state
      service:
        name: dnf-automatic.timer
        enabled: yes

    - name: Applying automatic updates.
      lineinfile: dest=/etc/dnf/automatic.conf
              regexp="^apply_updates = no"
              line="apply_updates = yes"
              state=present
      notify: Restart dnf-automatic.timer

    - name: Do nothing when laptop lid is closed
      lineinfile: dest=/etc/systemd/logind.conf
              regexp="^#HandleLidSwitch=suspend"
              line="HandleLidSwitch=ignore"
              state=present
      notify: Restart systemd-logind

    - name: Disallow password authentication
      lineinfile: dest=/etc/ssh/sshd_config
              regexp="^PasswordAuthentication yes"
              line="PasswordAuthentication no"
              state=present
      notify: Restart sshd

    - name: Disallow root SSH access
      lineinfile: dest=/etc/ssh/sshd_config
              regexp="^#PermitRootLogin yes"
              line="PermitRootLogin no"
              state=present
      notify: Restart sshd